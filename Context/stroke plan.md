Here are the exact code changes I made to add the stroke outline feature:

## 1. Added State Variable

```javascript
// BEFORE:
const [mandalaSpeed, setMandalaSpeed] = useState(1.0); // For mandala breathing speed
const timeRef = useRef(0);

// AFTER:
const [mandalaSpeed, setMandalaSpeed] = useState(1.0); // For mandala breathing speed
const [showStroke, setShowStroke] = useState(false); // For outline stroke
const timeRef = useRef(0);
```

## 2. Added to Dependency Array

```javascript
// BEFORE:
}, [wavelength, speed, threshold, gradientMode, patternType, color1, color2, color3, color4, sourceCount, lineDensity, mandalaComplexity, mandalaSpeed]);

// AFTER:
}, [wavelength, speed, threshold, gradientMode, patternType, color1, color2, color3, color4, sourceCount, lineDensity, mandalaComplexity, mandalaSpeed, showStroke]);
```

## 3. Added Stroke Drawing Function

```javascript
// ADDED THIS ENTIRE FUNCTION:
// Draw SVG stroke outline
const drawSVGStroke = () => {
  if (!showStroke) return;

  // Choose stroke color based on background
  const bgRgb = hexToRgb(color4);
  const brightness = (bgRgb.r * 299 + bgRgb.g * 587 + bgRgb.b * 114) / 1000;
  const strokeColor = brightness > 128 ? 'rgba(0, 0, 0, 0.8)' : 'rgba(255, 255, 255, 0.8)';
  
  // Calculate scaling and positioning to match the mask
  const svgAspectRatio = 2895 / 1255;
  const maxSize = Math.min(width, height) * 0.7;
  
  let drawWidth, drawHeight, drawX, drawY;
  
  if (svgAspectRatio > width / height) {
    drawWidth = maxSize;
    drawHeight = maxSize / svgAspectRatio;
  } else {
    drawHeight = maxSize;
    drawWidth = maxSize * svgAspectRatio;
  }
  
  drawX = (width - drawWidth) / 2;
  drawY = (height - drawHeight) / 2;

  // Scale factors to transform SVG coordinates to canvas coordinates
  const scaleX = drawWidth / 2895;
  const scaleY = drawHeight / 1255;

  ctx.save();
  ctx.translate(drawX, drawY);
  ctx.scale(scaleX, scaleY);
  ctx.lineWidth = 12 / Math.min(scaleX, scaleY); // Adjust line width for scale
  ctx.strokeStyle = strokeColor;
  ctx.lineCap = 'round';
  ctx.lineJoin = 'round';
  
  // Create path from SVG data (simplified outline)
  const path = new Path2D("M307.436 699.987C419.891 699.911 482.581 754.49 497.095 835.609L366.968 835.697C359.723 813.211 341.24 800.371 307.503 800.394C276.979 800.415 260.922 811.671 260.932 826.129C260.943 842.194 273.798 847.005 314.768 852.6L351.721 857.395C433.659 867.782 500.352 901.474 500.409 986.619C500.467 1072.57 427.409 1128.84 311.74 1128.92C194.465 1129 122.132 1068.8 113.24 986.076L244.974 985.988C254.631 1013.29 279.54 1024.52 312.474 1024.5C343.8 1024.48 362.268 1014.83 362.257 997.958C362.243 977.073 335.732 972.271 300.386 967.475L264.236 962.68C180.69 951.491 123.634 914.579 123.582 836.664C123.53 759.551 194.177 700.063 307.436 699.987ZM2312.88 699.442C2443.01 699.354 2524.2 794.887 2524.28 918.588C2524.29 924.211 2524.29 928.228 2522.69 941.884L2227.9 942.083C2238.38 995.893 2275.34 1012.74 2311.48 1012.71C2348.43 1012.69 2369.31 999.018 2378.13 980.538L2520.31 980.442C2500.28 1061.58 2417.59 1125.9 2308.35 1125.97C2175.81 1126.06 2090.6 1034.55 2090.52 911.651C2090.44 792.769 2176.33 699.534 2312.88 699.442ZM1993.46 709.417C2020.49 709.4 2042.45 716.558 2057.66 731.012C2072.9 745.492 2080.94 766.882 2080.96 794.392L2081.17 1117.18L1932 1117.28L1931.82 855.538C1931.82 847.389 1930.24 842.126 1927.21 838.867C1924.24 835.664 1919.24 833.74 1910.81 833.746L1835.99 833.796L1836.18 1117.35L1687.01 1117.45L1686.82 833.896L1612 833.947C1603.56 833.953 1598.57 835.882 1595.6 839.09C1592.58 842.353 1591.01 847.618 1591.01 855.767L1591.19 1117.51L1435.84 1117.61L1435.66 855.872C1435.66 847.723 1434.08 842.46 1431.05 839.201C1428.08 835.997 1423.08 834.074 1414.64 834.08L1339.82 834.13L1340.01 1117.68L1190.84 1117.78L1190.65 834.23L1115.83 834.281C1107.39 834.287 1102.4 836.214 1099.43 839.423C1096.41 842.686 1094.84 847.952 1094.85 856.101L1095.03 1117.84L945.852 1117.94L945.635 795.156C945.617 767.646 953.622 746.245 968.843 731.745C984.038 717.269 1005.99 710.083 1033.01 710.064L1497.29 709.751C1515.75 709.739 1530.71 709.639 1542.77 709.721L1993.46 709.417ZM922.798 1032.93C922.834 1086.74 891.526 1114.88 838.512 1114.92L610.388 1115.07C557.373 1115.1 526.027 1087.01 525.991 1033.19L525.775 713.5L668.755 713.403L668.929 972.05C668.94 988.919 675.372 996.947 693.043 996.935L755.697 996.893C773.368 996.881 779.789 988.844 779.777 971.976L779.604 713.329L922.583 713.232L922.798 1032.93ZM2790.1 830.051L2703.99 830.11C2686.32 830.122 2679.9 838.159 2679.91 855.027L2680.08 1113.67L2537.1 1113.77L2536.89 794.076C2536.85 740.258 2568.16 712.123 2621.17 712.087L2790.02 711.973L2790.1 830.051ZM2310.54 806.277C2273.59 806.302 2240.67 826.406 2231.06 864.968L2387.69 864.863C2378.83 825.509 2348.29 806.251 2310.54 806.277ZM1097.53 836.943C1096.91 837.566 1096.34 838.239 1095.83 838.966V838.973C1096.24 838.392 1096.68 837.846 1097.16 837.331C1097.28 837.2 1097.4 837.07 1097.53 836.943ZM1097.89 836.585C1097.77 836.703 1097.65 836.822 1097.53 836.943C1097.65 836.822 1097.77 836.703 1097.89 836.585ZM986.431 723.061C986.301 723.128 986.173 723.198 986.044 723.265C986.393 723.082 986.749 722.91 987.103 722.732C986.88 722.844 986.652 722.947 986.431 723.061ZM993.291 719.954C993.413 719.905 993.534 719.855 993.656 719.807H993.648C993.528 719.854 993.411 719.906 993.291 719.954ZM997.473 718.424C997.346 718.467 997.22 718.513 997.094 718.556C997.423 718.444 997.754 718.336 998.086 718.227C997.882 718.294 997.676 718.356 997.473 718.424ZM1014.17 714.486C1013.86 714.532 1013.55 714.592 1013.25 714.64C1013.76 714.56 1014.28 714.479 1014.79 714.405L1014.17 714.486ZM1528.17 712.804C1519.19 712.813 1508.95 712.839 1497.3 712.847L1033.01 713.16V713.167L1497.3 712.854C1508.95 712.846 1519.19 712.817 1528.17 712.804ZM1542.32 712.817C1542.7 712.819 1543.08 712.82 1543.45 712.823L1993.47 712.52C1993.63 712.52 1993.79 712.521 1993.96 712.521L1993.47 712.513L1542.32 712.817ZM305.97 256.858C421.54 256.78 511.818 343.514 511.902 468.53C511.986 592.75 421.825 680.402 306.255 680.48C190.685 680.558 101.152 593.026 101.068 468.806C100.984 343.79 190.4 256.936 305.97 256.858ZM1140.6 257.585C1246.58 257.514 1322.22 330.498 1337.11 430.514L1206.68 430.602C1197.03 403.617 1174.78 385.373 1142.17 385.395C1101.41 385.423 1070.31 418.786 1070.34 468.799C1070.38 518.018 1100.78 552.134 1142.28 552.106C1174.15 552.085 1197.85 533.016 1207.47 506.018L1339.38 505.929C1326.11 604.377 1249.09 679.846 1140.89 679.918C1026.76 679.995 937.77 594.318 937.686 468.888C937.602 345.046 1026.47 257.662 1140.6 257.585ZM1939.53 257.851C1981.3 257.823 2015.35 272.911 2032.39 297.555L2049.41 297.543L2049.39 269.707L2187.09 269.615L2187.36 667.284L2051.2 667.375L2051.18 631.585L2034.16 631.597C2014.84 662.628 1979.27 679.354 1932.85 679.385C1839.25 679.448 1768.02 599.166 1767.94 472.708C1767.85 343.863 1852.11 257.91 1939.53 257.851ZM837.814 270.633C890.829 270.598 922.175 298.691 922.211 352.509L922.426 672.204L779.447 672.3L779.272 413.652C779.261 396.784 772.83 388.756 755.158 388.768L692.505 388.81C674.833 388.822 668.412 396.859 668.424 413.727L668.598 672.375L525.619 672.471L525.403 352.776C525.367 298.958 556.676 270.823 609.69 270.788L837.814 270.633ZM1497.35 270.196L1666.84 270.082C1719.85 270.046 1751.2 298.139 1751.24 351.957L1751.45 671.652L1608.47 671.748L1608.3 413.1C1608.29 396.232 1601.86 388.203 1584.18 388.215L1497.43 388.274L1497.62 671.823L1354.64 671.918L1354.27 117.673L1497.25 117.578L1497.35 270.196ZM2361.99 671.242L2219.01 671.338L2218.74 269.711L2361.71 269.615L2361.99 671.242ZM2702.96 269.389C2755.97 269.354 2787.32 297.446 2787.35 351.264L2787.57 670.959L2644.59 671.055L2644.42 412.408C2644.41 395.54 2637.97 387.511 2620.3 387.523L2557.65 387.565C2539.98 387.577 2533.56 395.614 2533.57 412.482L2533.74 671.129L2390.76 671.226L2390.55 351.531C2390.51 297.713 2421.82 269.578 2474.83 269.542L2702.96 269.389ZM306.057 385.059C265.048 385.087 234.499 417.754 234.533 468.716C234.567 518.882 265.16 552.305 306.169 552.278C347.178 552.25 378.471 518.785 378.438 468.62C378.403 417.658 347.065 385.032 306.057 385.059ZM1980.62 385.078C1936.52 385.108 1906.37 419.327 1906.41 468.638C1906.44 517.949 1936.63 552.129 1980.73 552.099C2025.6 552.069 2053.42 514.669 2053.39 468.54C2053.36 422.41 2025.49 385.047 1980.62 385.078ZM2361.69 232.666L2218.71 232.762L2218.63 117.093L2361.61 116.997L2361.69 232.666Z");
  
  ctx.stroke(path);
  ctx.restore();
};
```

## 4. Added Function Call in Animation Loop

```javascript
// BEFORE:
ctx.putImageData(imageData, 0, 0);
timeRef.current += speed;
animationFrameId = requestAnimationFrame(animate);

// AFTER:
ctx.putImageData(imageData, 0, 0);

// Draw stroke outline if enabled
if (showStroke) {
  drawSVGStroke();
}

timeRef.current += speed;
animationFrameId = requestAnimationFrame(animate);
```

## 5. Added UI Toggle Control

```javascript
// ADDED THIS ENTIRE SECTION:
<div style={{ marginBottom: '15px' }}>
  <label style={{ display: 'flex', alignItems: 'center', color: '#666', cursor: 'pointer' }}>
    <input
      type="checkbox"
      checked={showStroke}
      onChange={(e) => setShowStroke(e.target.checked)}
      style={{ marginRight: '8px' }}
    />
    Show Outline Stroke
  </label>
</div>
```



## Key Technical Details:

- **State management**: Simple boolean state with checkbox toggle
- **Smart color detection**: Uses luminance formula to determine stroke color
- **Canvas Path2D**: High-performance direct canvas drawing 
- **Exact scaling**: Matches the SVG mask transformation perfectly
- **Conditional rendering**: Only draws stroke when toggle is enabled
- **Performance optimized**: No async operations, direct canvas API calls

The stroke is drawn after the pattern fills but before the next frame, ensuring it appears on top of the pattern while maintaining smooth animation performance.